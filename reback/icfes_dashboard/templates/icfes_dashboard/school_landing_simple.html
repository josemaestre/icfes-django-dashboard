<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ seo.title|default:school.nombre }}</title>
    <meta name="description" content="{{ seo.description|default:'Resultados ICFES del colegio' }}">
    <meta name="robots" content="{{ seo.robots|default:'index, follow' }}">
    <link rel="canonical" href="{{ canonical_url }}">
    <link rel="icon" href="/static/images/favicon.ico" type="image/x-icon">

    <meta property="og:locale" content="es_CO">
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="ICFES Analytics">
    <meta property="og:title" content="{{ seo.title|default:school.nombre }}">
    <meta property="og:description" content="{{ seo.description|default:'Resultados ICFES del colegio' }}">
    <meta property="og:url" content="{{ canonical_url }}">
    <meta property="og:image" content="{{ seo.og_image }}">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{{ seo.title|default:school.nombre }}">
    <meta name="twitter:description" content="{{ seo.description|default:'Resultados ICFES del colegio' }}">
    <meta name="twitter:image" content="{{ seo.og_image }}">

    <script type="application/ld+json">{{ structured_data_json|safe }}</script>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <style>
        body {
            font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f7fa;
        }

        .hero-section {
            background: linear-gradient(135deg, #1e4d92 0%, #0f766e 100%);
            color: white;
            padding: 56px 0;
            margin-bottom: 32px;
        }

        .info-badge {
            display: inline-block;
            padding: 6px 14px;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 999px;
            margin: 5px 6px 0 0;
            font-size: 0.95rem;
        }

        .card-block {
            background: #fff;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.08);
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 16px;
            color: #223;
        }

        .stat-card {
            background: #fff;
            border-radius: 10px;
            padding: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            margin-bottom: 16px;
            text-align: center;
        }

        .stat-label {
            color: #5f6673;
            font-size: 0.84rem;
            text-transform: uppercase;
            letter-spacing: .08em;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #1e4d92;
        }

        .subject-score {
            float: right;
            font-weight: 700;
            color: #1e4d92;
        }

        .strength-item,
        .weakness-item,
        .action-item {
            padding: 10px 12px;
            border-radius: 6px;
            margin: 8px 0;
        }

        .strength-item {
            background: #e8f5e9;
            border-left: 4px solid #4caf50;
        }

        .weakness-item {
            background: #fff3e0;
            border-left: 4px solid #ff9800;
        }

        .action-item {
            background: #eef4ff;
            border-left: 4px solid #1e4d92;
        }

        .comparison-item {
            padding: 14px;
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 12px;
        }

        .comparison-label {
            font-weight: 600;
            color: #445;
            margin-bottom: 8px;
            font-size: 0.92rem;
        }

        .comparison-values {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .avg-value {
            color: #666;
            font-size: 0.9rem;
        }

        .gap-value {
            font-weight: 700;
            font-size: 1rem;
            padding: 4px 10px;
            border-radius: 999px;
        }

        .gap-value.positive {
            color: #2e7d32;
            background: #e8f5e9;
        }

        .gap-value.negative {
            color: #d32f2f;
            background: #ffebee;
        }

        .footer {
            background: #1f2937;
            color: #fff;
            padding: 20px 0;
            margin-top: 40px;
            text-align: center;
        }

        .cta-button {
            background: #1e4d92;
            color: #fff;
            padding: 12px 24px;
            border-radius: 999px;
            text-decoration: none;
            display: inline-block;
            font-weight: 700;
        }

        .cta-button:hover {
            color: #fff;
            background: #153b71;
        }

        .simple-table td,
        .simple-table th {
            vertical-align: middle;
        }

        .metric-chip {
            display: inline-block;
            background: #ecfdf5;
            color: #166534;
            padding: 5px 10px;
            border-radius: 999px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 0.86rem;
        }

        .trophy-card {
            border: 1px solid #e2e8f0;
            border-top: 3px solid var(--badge-color, #1e4d92);
            border-radius: 10px;
            padding: 20px 16px 16px;
            margin-bottom: 14px;
            background: #ffffff;
            text-align: center;
        }

        .trophy-icon {
            font-size: 2rem;
            color: var(--badge-color, #1e4d92);
            margin-bottom: 8px;
            display: block;
        }

        .trophy-title {
            font-weight: 700;
            color: #1f2a44;
            font-size: 0.9rem;
            margin-bottom: 2px;
        }

        .trophy-subtitle {
            color: #6b7280;
            font-size: 0.78rem;
            margin-bottom: 10px;
        }

        .trophy-value {
            font-size: 2.2rem;
            font-weight: 700;
            color: var(--badge-color, #1e4d92);
            line-height: 1;
            margin-bottom: 8px;
        }

        .trophy-rank {
            display: inline-block;
            font-size: 0.75rem;
            font-weight: 700;
            color: #0f766e;
            background: #e6fffa;
            border-radius: 999px;
            padding: 3px 9px;
        }

        .trophy-delta {
            margin-top: 8px;
            font-size: 0.82rem;
            font-weight: 600;
        }

        .trophy-delta.positive {
            color: #15803d;
        }

        .trophy-delta.negative {
            color: #dc2626;
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="container">
            <h1 class="display-5">{{ school.nombre }}</h1>
            <div class="mt-3">
                <span class="info-badge">{{ school.municipio }}, {{ school.departamento }}</span>
                <span class="info-badge">{{ school.sector }}</span>
                <span class="info-badge">Código DANE {{ school.codigo }}</span>
            </div>
            {% if school.direccion or school.telefono or school.email or school.rector %}
            <div class="mt-3" style="font-size: 0.9rem; opacity: 0.9;">
                {% if school.direccion %}<div>{{ school.direccion }}</div>{% endif %}
                {% if school.telefono %}<div>Tel: {{ school.telefono }}</div>{% endif %}
                {% if school.email %}<div>{{ school.email }}</div>{% endif %}
                {% if school.rector %}<div>Rector(a): {{ school.rector }}</div>{% endif %}
            </div>
            {% endif %}
        </div>
    </div>

    <div class="container">
        {% if has_data %}
        <div class="card-block">
            <h2 class="section-title">Resumen ejecutivo</h2>
            <p class="mb-2">{{ narrative_summary }}</p>

            {% if comparison %}
            <div class="mt-2">
                {% if comparison.percentil_municipal is not None %}
                <span class="metric-chip">Percentil municipal {{ comparison.percentil_municipal }}</span>
                {% endif %}
                {% if comparison.percentil_departamental is not None %}
                <span class="metric-chip">Percentil departamental {{ comparison.percentil_departamental }}</span>
                {% endif %}
                {% if comparison.percentil_nacional is not None %}
                <span class="metric-chip">Percentil nacional {{ comparison.percentil_nacional }}</span>
                {% endif %}
            </div>
            {% endif %}

            <div class="mt-3">
                <a href="{{ internal_links.municipio_url }}" class="btn btn-sm btn-outline-primary me-2">Ver colegios del municipio</a>
                <a href="{{ internal_links.departamento_url }}" class="btn btn-sm btn-outline-primary">Ver colegios del departamento</a>
            </div>
        </div>

        {% if dynamic_description %}
        <div class="card-block">
            <h3 class="section-title">Análisis de desempeño académico</h3>
            {% for paragraph in dynamic_description %}
            <p class="mb-2">{{ paragraph }}</p>
            {% endfor %}
        </div>
        {% endif %}

        {% if best_muni or best_dept %}
        <div class="card-block">
            <h3 class="section-title">Líderes en calidad (mismo sector)</h3>
            <div class="row">
                {% if best_muni %}
                <div class="col-md-6">
                    <div class="comparison-item">
                        <div class="comparison-label">Mejor del municipio ({{ best_muni.municipio }})</div>
                        <p class="mb-1"><strong>{{ best_muni.name }}</strong></p>
                        <p class="mb-1">Puntaje: {{ best_muni.score }}</p>
                        {% if best_muni.diff is not None and best_muni.diff > 0 %}
                        <p class="mb-2 text-muted">{{ best_muni.diff }} puntos por encima de este colegio</p>
                        {% endif %}
                        <a href="{{ best_muni.url }}" class="btn btn-sm btn-outline-primary">Ver colegio</a>
                    </div>
                </div>
                {% endif %}
                {% if best_dept %}
                <div class="col-md-6">
                    <div class="comparison-item">
                        <div class="comparison-label">Mejor del departamento ({{ best_dept.departamento }})</div>
                        <p class="mb-1"><strong>{{ best_dept.name }}</strong></p>
                        <p class="mb-1">Puntaje: {{ best_dept.score }}</p>
                        <p class="mb-2 text-muted">{{ best_dept.municipio }}</p>
                        <a href="{{ best_dept.url }}" class="btn btn-sm btn-outline-primary">Ver colegio</a>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>
        {% endif %}

        <div class="row">
            <div class="col-lg-8">
                <div class="card-block">
                    <h2 class="section-title">Resultados ICFES {{ stats.year }}</h2>
                    <div class="row">
                        <div class="col-md-4"><div class="stat-card"><div class="stat-label">Puntaje Global</div><div class="stat-value">{{ stats.global|default:"N/A" }}</div></div></div>
                        <div class="col-md-4"><div class="stat-card"><div class="stat-label">Matemáticas</div><div class="stat-value">{{ stats.matematicas|default:"N/A" }}</div></div></div>
                        <div class="col-md-4"><div class="stat-card"><div class="stat-label">Lectura Crítica</div><div class="stat-value">{{ stats.lectura|default:"N/A" }}</div></div></div>
                        <div class="col-md-4"><div class="stat-card"><div class="stat-label">Ciencias Naturales</div><div class="stat-value">{{ stats.ciencias|default:"N/A" }}</div></div></div>
                        <div class="col-md-4"><div class="stat-card"><div class="stat-label">Sociales y Ciudadanas</div><div class="stat-value">{{ stats.sociales|default:"N/A" }}</div></div></div>
                        <div class="col-md-4"><div class="stat-card"><div class="stat-label">Inglés</div><div class="stat-value">{{ stats.ingles|default:"N/A" }}</div></div></div>
                    </div>
                    <div class="stat-card mt-2">
                        <div class="stat-label">Estudiantes evaluados</div>
                        <div class="stat-value">{{ stats.estudiantes|default:"0" }}</div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card-block">
                    <h3 class="section-title">Fortalezas</h3>
                    {% for subject, score in top_strengths %}
                    <div class="strength-item">{{ subject }} <span class="subject-score">{{ score }}</span></div>
                    {% endfor %}
                </div>
                <div class="card-block">
                    <h3 class="section-title">Áreas de mejora</h3>
                    {% for subject, score in top_weaknesses %}
                    <div class="weakness-item">{{ subject }} <span class="subject-score">{{ score }}</span></div>
                    {% endfor %}
                </div>
            </div>
        </div>

        {% if comparison %}
        <div class="card-block">
            <h3 class="section-title">Comparación con promedios {{ stats.year }}</h3>
            <div class="row">
                <div class="col-md-4">
                    <div class="comparison-item">
                        <div class="comparison-label">Municipal ({{ school.municipio }})</div>
                        <div class="comparison-values">
                            <span class="avg-value">Promedio: {{ comparison.promedio_municipal }}</span>
                            <span class="gap-value {{ comparison.brecha_municipal_class }}">{{ comparison.brecha_municipal_display }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="comparison-item">
                        <div class="comparison-label">Departamental ({{ school.departamento }})</div>
                        <div class="comparison-values">
                            <span class="avg-value">Promedio: {{ comparison.promedio_departamental }}</span>
                            <span class="gap-value {{ comparison.brecha_departamental_class }}">{{ comparison.brecha_departamental_display }}</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="comparison-item">
                        <div class="comparison-label">Nacional</div>
                        <div class="comparison-values">
                            <span class="avg-value">Promedio: {{ comparison.promedio_nacional }}</span>
                            <span class="gap-value {{ comparison.brecha_nacional_class }}">{{ comparison.brecha_nacional_display }}</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="row">
            <div class="col-lg-6">
                <div class="card-block">
                    <h3 class="section-title">Perfil de desempeño</h3>
                    <div style="position: relative; height: 330px;"><canvas id="radarChart"></canvas></div>
                </div>
            </div>

            {% if historical_chart.has_data %}
            <div class="col-lg-6">
                <div class="card-block">
                    <h3 class="section-title">Evolución histórica</h3>
                    <div style="position: relative; height: 330px;"><canvas id="historicalChart"></canvas></div>
                    {% if performance_signals.trend_3y is not None %}
                    <p class="mt-3 mb-0">Tendencia 3 años: {{ performance_signals.trend_3y }} puntos.</p>
                    {% endif %}
                    {% if performance_signals.trend_5y is not None %}
                    <p class="mb-0">Tendencia 5 años: {{ performance_signals.trend_5y }} puntos.</p>
                    {% endif %}
                    {% if performance_signals.stability_std is not None %}
                    <p class="mb-0">Variabilidad histórica (desv. estándar): {{ performance_signals.stability_std }}.</p>
                    {% endif %}
                </div>
            </div>
            {% endif %}
        </div>

        <div class="row">
            <div class="col-lg-6">
                <div class="card-block">
                    <h3 class="section-title">Acciones recomendadas</h3>
                    {% for recommendation in action_recommendations %}
                    <div class="action-item">{{ recommendation }}</div>
                    {% endfor %}
                </div>
            </div>
            <div class="col-lg-6">
                <div class="card-block">
                    <h3 class="section-title">Tabla de materias</h3>
                    <div class="table-responsive">
                        <table class="table table-sm simple-table">
                            <thead>
                                <tr>
                                    <th>Materia</th>
                                    <th class="text-end">Puntaje</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for item in subject_rows %}
                                <tr>
                                    <td>{{ item.name }}</td>
                                    <td class="text-end"><strong>{{ item.score }}</strong></td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        {% if indicators %}
        {% if indicator_badges %}
        <div class="card-block">
            <h3 class="section-title">Trofeos de desempeño académico</h3>
            <div class="row">
                {% for badge in indicator_badges %}
                <div class="col-md-6 col-lg-3">
                    <div class="trophy-card" style="--badge-color: {{ badge.color }};">
                        <i class="bi {{ badge.icon }} trophy-icon"></i>
                        <div class="trophy-title">{{ badge.title }}</div>
                        <div class="trophy-subtitle">{{ badge.subtitle }}</div>
                        <div class="trophy-value">{{ badge.value|default_if_none:"N/A" }}%</div>
                        <span class="trophy-rank">{{ badge.rank_label }}</span>
                        <div class="trophy-delta {{ badge.delta_class }}">{{ badge.delta_display }} vs año anterior</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        {% endif %}

        {% if similar_schools %}
        <div class="card-block">
            <h3 class="section-title">Colegios similares del municipio</h3>
            <ul class="mb-0">
                {% for school_item in similar_schools %}
                <li><a href="{{ school_item.url }}">{{ school_item.name }}</a> (puntaje {{ school_item.score }})</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="card-block">
            <h3 class="section-title">Preguntas frecuentes</h3>
            <div class="accordion" id="faqAccordion">
                {% for faq in faq_items %}
                <div class="accordion-item">
                    <h2 class="accordion-header" id="faqHeading{{ forloop.counter }}">
                        <button class="accordion-button {% if not forloop.first %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#faqCollapse{{ forloop.counter }}" aria-expanded="{% if forloop.first %}true{% else %}false{% endif %}" aria-controls="faqCollapse{{ forloop.counter }}">
                            {{ faq.question }}
                        </button>
                    </h2>
                    <div id="faqCollapse{{ forloop.counter }}" class="accordion-collapse collapse {% if forloop.first %}show{% endif %}" aria-labelledby="faqHeading{{ forloop.counter }}" data-bs-parent="#faqAccordion">
                        <div class="accordion-body">{{ faq.answer }}</div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        {% else %}
        <div class="alert alert-info">
            <h4>Información no disponible</h4>
            <p>Actualmente no tenemos datos suficientes de resultados ICFES para este colegio.</p>
        </div>
        {% endif %}

        <div class="card-block text-center">
            <h3>¿Quieres un diagnóstico completo de tu colegio?</h3>
            <p class="lead">Obtén reportes personalizados con brechas por materia, tendencias históricas y acciones concretas de mejora.</p>
            <div class="d-flex flex-column flex-sm-row justify-content-center gap-2">
                <a href="/landing/?utm_source=seo&utm_medium=landing&utm_campaign=school_landing&utm_content=cta_planes" class="cta-button">Solicitar diagnóstico gratuito</a>
                <a href="/icfes/departamentos/?utm_source=seo&utm_medium=landing&utm_campaign=school_landing&utm_content=cta_portal" class="btn btn-outline-primary btn-lg">Explorar el portal ICFES</a>
            </div>
        </div>
    </div>

    <div class="footer">
        <div class="container">
            <p class="mb-0">&copy; 2026 ICFES Analytics. Un producto de <a href="https://www.sabededatos.com" target="_blank" rel="noopener noreferrer" style="color: #fff; text-decoration: underline;">www.sabededatos.com</a></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" defer></script>

    {% if has_data %}
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            if (typeof Chart === "undefined") {
                return;
            }

            const radarEl = document.getElementById("radarChart");
            if (radarEl) {
                new Chart(radarEl.getContext("2d"), {
                    type: "radar",
                    data: {
                        labels: {{ radar_data.labels|safe }},
                        datasets: [{
                            label: "Puntajes {{ stats.year }}",
                            data: {{ radar_data.values|safe }},
                            backgroundColor: "rgba(30, 77, 146, 0.15)",
                            borderColor: "rgba(30, 77, 146, 1)",
                            borderWidth: 2,
                            pointBackgroundColor: "rgba(30, 77, 146, 1)",
                            pointBorderColor: "#fff"
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: { stepSize: 20 }
                            }
                        },
                        plugins: { legend: { display: false } }
                    }
                });
            }

            {% if historical_chart.has_data %}
            const historyEl = document.getElementById("historicalChart");
            if (historyEl) {
                new Chart(historyEl.getContext("2d"), {
                    type: "line",
                    data: {
                        labels: {{ historical_chart.years|safe }},
                        datasets: [{
                            label: "Puntaje Global",
                            data: {{ historical_chart.scores|safe }},
                            borderColor: "#1e4d92",
                            backgroundColor: "rgba(30, 77, 146, 0.1)",
                            borderWidth: 3,
                            pointBackgroundColor: "#fff",
                            pointBorderColor: "#1e4d92",
                            pointRadius: 4,
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            y: { beginAtZero: false },
                            x: { grid: { display: false } }
                        }
                    }
                });
            }
            {% endif %}
        });
    </script>
    {% endif %}
</body>
</html>
