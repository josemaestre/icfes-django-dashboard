{% extends 'layout_vertical.html' %}

{% load static i18n %}

{% block title %}ICFES Dashboard{% endblock title %}

{% block page_title %}
{% include "partials/page-title.html" with page_title='ICFES' sub_title='Dashboards' %}
{% endblock page_title %}

{% block page_content %}
<!-- Tab Navigation -->
<ul class="nav nav-tabs nav-tabs-custom mb-3" role="tablist">
  <li class="nav-item">
    <a class="nav-link active" data-bs-toggle="tab" href="#vista-general" role="tab">
      <i class="bx bx-bar-chart me-1"></i> Vista General
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#busqueda-colegio" role="tab">
      <i class="bx bx-search me-1"></i> B√∫squeda de Colegio
    </a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-bs-toggle="tab" href="#explorador" role="tab">
      <i class="bx bx-list-ul me-1"></i> Explorador Jer√°rquico
    </a>
  </li>
</ul>

<!-- Tab Content -->
<div class="tab-content">
  <!-- Vista General Tab -->
  <div class="tab-pane fade show active" id="vista-general" role="tabpanel">
    <!-- KPI Cards Row -->
    <div class="row">
      <div class="col">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h3 class="mb-0 fw-bold mb-2" id="stat-estudiantes">--</h3>
                <p class="text-muted">Total Estudiantes</p>
                <span class="badge fs-12 badge-soft-info">
                  <i class="ti ti-users"></i> A√±o <span id="year-display">2024</span>
                </span>
              </div>
              <div>
                <div class="avatar-lg d-inline-block me-1">
                  <span class="avatar-title bg-info-subtle text-info rounded-circle">
                    <iconify-icon icon="iconamoon:profile-circle-duotone" class="fs-32"></iconify-icon>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h3 class="mb-0 fw-bold mb-2" id="stat-promedio">--</h3>
                <p class="text-muted">Promedio Nacional</p>
                <span class="badge fs-12 badge-soft-primary">
                  <i class="ti ti-chart-line"></i> Puntaje Global
                </span>
              </div>
              <div>
                <div class="avatar-lg d-inline-block me-1">
                  <span class="avatar-title bg-primary-subtle text-primary rounded-circle">
                    <iconify-icon icon="iconamoon:bar-chart-duotone" class="fs-32"></iconify-icon>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h3 class="mb-0 fw-bold mb-2" id="stat-colegios">--</h3>
                <p class="text-muted">Total Colegios</p>
                <span class="badge fs-12 badge-soft-success">
                  <i class="ti ti-building"></i> Instituciones
                </span>
              </div>
              <div>
                <div class="avatar-lg d-inline-block me-1">
                  <span class="avatar-title bg-success-subtle text-success rounded-circle">
                    <iconify-icon icon="iconamoon:home-duotone" class="fs-32"></iconify-icon>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col">
        <div class="card">
          <div class="card-body">
            <div class="d-flex align-items-center justify-content-between">
              <div>
                <h3 class="mb-0 fw-bold mb-2" id="stat-departamentos">--</h3>
                <p class="text-muted">Departamentos</p>
                <span class="badge fs-12 badge-soft-warning">
                  <i class="ti ti-map-pin"></i> Regiones
                </span>
              </div>
              <div>
                <div class="avatar-lg d-inline-block me-1">
                  <span class="avatar-title bg-warning-subtle text-warning rounded-circle">
                    <iconify-icon icon="iconamoon:location-pin-duotone" class="fs-32"></iconify-icon>
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Charts Row -->
    <div class="row">
      <div class="col-xxl-8">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="card-title">Tendencias Nacionales (1996-2024)</h4>
            <div>
              <select id="year-selector" class="form-select form-select-sm">
                <optgroup label="2020s">
                  <option value="2024">2024</option>
                  <option value="2023">2023</option>
                  <option value="2022">2022</option>
                  <option value="2021">2021</option>
                  <option value="2020">2020</option>
                </optgroup>
                <optgroup label="2010s">
                  <option value="2019">2019</option>
                  <option value="2018">2018</option>
                  <option value="2017">2017</option>
                  <option value="2016">2016</option>
                  <option value="2015">2015</option>
                  <option value="2014">2014</option>
                  <option value="2013">2013</option>
                  <option value="2012">2012</option>
                  <option value="2011">2011</option>
                  <option value="2010">2010</option>
                </optgroup>
                <optgroup label="2000s">
                  <option value="2009">2009</option>
                  <option value="2008">2008</option>
                  <option value="2007">2007</option>
                  <option value="2006">2006</option>
                  <option value="2005">2005</option>
                  <option value="2004">2004</option>
                  <option value="2003">2003</option>
                  <option value="2002">2002</option>
                  <option value="2001">2001</option>
                  <option value="2000">2000</option>
                </optgroup>
                <optgroup label="1990s">
                  <option value="1999">1999</option>
                  <option value="1998">1998</option>
                  <option value="1997">1997</option>
                  <option value="1996">1996</option>
                </optgroup>
              </select>
            </div>
          </div>
          <div class="card-body">
            <div dir="ltr">
              <div id="chart-tendencias" class="apex-charts"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xxl-4">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="card-title">Distribuci√≥n Regional</h4>
          </div>
          <div class="card-body">
            <div dir="ltr">
              <div id="chart-regional" class="apex-charts"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Secondary Charts Row -->
    <div class="row">
      <div class="col-xxl-6">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="card-title">Comparaci√≥n por Sectores</h4>
          </div>
          <div class="card-body">
            <div dir="ltr">
              <div id="chart-sectores" class="apex-charts"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xxl-6">
        <div class="card">
          <div class="card-header d-flex justify-content-between align-items-center">
            <h4 class="card-title">Top 10 Departamentos</h4>
          </div>
          <div class="card-body">
            <div dir="ltr">
              <div id="chart-departamentos" class="apex-charts"></div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Top Colegios Table -->
    <div class="row">
      <div class="col-12">
        <div class="card">
          <div class="d-flex card-header justify-content-between align-items-center">
            <h4 class="card-title">Top 50 Colegios Destacados</h4>
            <div class="flex-shrink-0">
              <span class="badge bg-primary-subtle text-primary">A√±o <span id="table-year">2024</span></span>
            </div>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive table-card">
              <table class="table table-borderless table-hover table-nowrap align-middle mb-0">
                <thead class="bg-light bg-opacity-50 thead-sm">
                  <tr>
                    <th scope="col">Ranking</th>
                    <th scope="col">Colegio</th>
                    <th scope="col">Departamento</th>
                    <th scope="col">Municipio</th>
                    <th scope="col">Sector</th>
                    <th scope="col">Promedio</th>
                    <th scope="col">Estudiantes</th>
                  </tr>
                </thead>
                <tbody id="table-colegios-body">
                  <tr>
                    <td colspan="7" class="text-center py-4">
                      <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
          <div class="card-footer border-top border-light">
            <div class="align-items-center justify-content-between row text-center text-sm-start">
              <div class="col-sm">
                <div class="text-muted">
                  Mostrando <span class="fw-semibold text-body">50</span> colegios destacados
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- B√∫squeda de Colegio Tab -->
  <div class="tab-pane fade" id="busqueda-colegio" role="tabpanel">
    <!-- Search Box -->
    <div class="row mb-3">
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <div class="input-group">
              <input type="text" class="form-control form-control-lg" id="searchColegioInput"
                placeholder="Buscar colegio por nombre o c√≥digo DANE..." autocomplete="off">
              <button class="btn btn-primary" type="button" id="searchColegioBtn">
                <i class="bx bx-search"></i> Buscar
              </button>
            </div>
            <div id="searchColegioResults" class="mt-2"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- School Detail Section (hidden initially) -->
    <div id="schoolDetailSection" style="display: none;">
      <!-- School Header -->
      <div class="row mb-3">
        <div class="col-12">
          <div class="card bg-primary bg-gradient">
            <div class="card-body text-white">
              <h3 class="text-white mb-2" id="schoolDetailName">-</h3>
              <p class="mb-0">
                <span class="badge bg-light text-dark me-2" id="schoolDetailDane">-</span>
                <span class="badge bg-light text-dark me-2" id="schoolDetailSector">-</span>
                <span id="schoolDetailLocation">-</span>
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="row mb-3">
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <h3 class="mb-0 fw-bold" id="schoolStatPuntaje">--</h3>
              <p class="text-muted mb-0">Puntaje Global</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <h3 class="mb-0 fw-bold" id="schoolStatRanking">--</h3>
              <p class="text-muted mb-0">Ranking Nacional</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <h3 class="mb-0 fw-bold" id="schoolStatEstudiantes">--</h3>
              <p class="text-muted mb-0">Estudiantes</p>
            </div>
          </div>
        </div>
        <div class="col-md-3">
          <div class="card">
            <div class="card-body text-center">
              <h3 class="mb-0 fw-bold" id="schoolStatZScore">--</h3>
              <p class="text-muted mb-0">
                Z-Score
                <i class="bx bx-info-circle" data-bs-toggle="tooltip" data-bs-placement="top"
                  title="Mide cu√°ntas desviaciones est√°ndar est√° el colegio del promedio nacional. +2 = √âlite, 0 = Promedio, -2 = Bajo"></i>
              </p>
              <small id="schoolStatZScoreInterpretation" class="text-muted">--</small>
            </div>
          </div>
        </div>
      </div>

      <!-- Charts Row -->
      <div class="row">
        <div class="col-md-12 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Evoluci√≥n Hist√≥rica</h5>
            </div>
            <div class="card-body">
              <div id="schoolChartHistorico"></div>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Desempe√±o por Materia</h5>
            </div>
            <div class="card-body">
              <div id="schoolChartRadar"></div>
            </div>
          </div>
        </div>
        <div class="col-md-6 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Comparaci√≥n con Promedios</h5>
            </div>
            <div class="card-body">
              <div id="schoolChartComparacion"></div>
            </div>
          </div>
        </div>
      </div>

      <!-- NEW: An√°lisis Comparativo Section -->
      <div class="row">
        <div class="col-12 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">üìä An√°lisis Comparativo</h5>
            </div>
            <div class="card-body">
              <div class="row">
                <!-- Brechas -->
                <div class="col-md-4">
                  <h6 class="text-muted mb-3">Brechas vs Promedios</h6>
                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <span>vs Municipal</span>
                      <span id="brechaMunicipal" class="badge bg-secondary">--</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                      <div id="brechaMunicipalBar" class="progress-bar" role="progressbar" style="width: 50%"></div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <span>vs Departamental</span>
                      <span id="brechaDepartamental" class="badge bg-secondary">--</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                      <div id="brechaDepartamentalBar" class="progress-bar" role="progressbar" style="width: 50%"></div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <span>vs Nacional</span>
                      <span id="brechaNacional" class="badge bg-secondary">--</span>
                    </div>
                    <div class="progress" style="height: 8px;">
                      <div id="brechaNacionalBar" class="progress-bar" role="progressbar" style="width: 50%"></div>
                    </div>
                  </div>
                </div>

                <!-- Percentiles -->
                <div class="col-md-4">
                  <h6 class="text-muted mb-3">Posici√≥n Relativa (Percentiles)</h6>
                  <div class="mb-3">
                    <label class="form-label small">Municipal</label>
                    <div class="d-flex align-items-center">
                      <div class="progress flex-grow-1 me-2" style="height: 20px;">
                        <div id="percentilMunicipalBar" class="progress-bar bg-info" role="progressbar"
                          style="width: 0%">
                          <span id="percentilMunicipal" class="small">--</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label small">Departamental</label>
                    <div class="d-flex align-items-center">
                      <div class="progress flex-grow-1 me-2" style="height: 20px;">
                        <div id="percentilDepartamentalBar" class="progress-bar bg-info" role="progressbar"
                          style="width: 0%">
                          <span id="percentilDepartamental" class="small">--</span>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label small">Nacional</label>
                    <div class="d-flex align-items-center">
                      <div class="progress flex-grow-1 me-2" style="height: 20px;">
                        <div id="percentilNacionalBar" class="progress-bar bg-info" role="progressbar"
                          style="width: 0%">
                          <span id="percentilNacional" class="small">--</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Clasificaciones -->
                <div class="col-md-4">
                  <h6 class="text-muted mb-3">Clasificaci√≥n de Rendimiento</h6>
                  <div class="mb-3">
                    <label class="form-label small">vs Municipal</label>
                    <div id="clasificacionMunicipal" class="alert alert-secondary mb-0 py-2">--</div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label small">vs Departamental</label>
                    <div id="clasificacionDepartamental" class="alert alert-secondary mb-0 py-2">--</div>
                  </div>
                  <div class="mb-3">
                    <label class="form-label small">vs Nacional</label>
                    <div id="clasificacionNacional" class="alert alert-secondary mb-0 py-2">--</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Performance Table -->
      <div class="row">
        <div class="col-12 mb-3">
          <div class="card">
            <div class="card-header">
              <h5 class="card-title mb-0">Evoluci√≥n Hist√≥rica por A√±o</h5>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover table-sm" id="schoolPerformanceTable">
                  <thead class="table-light">
                    <tr>
                      <th>A√±o</th>
                      <th class="text-end">Global</th>
                      <th class="text-end">Matem√°ticas</th>
                      <th class="text-end">Lectura</th>
                      <th class="text-end">C. Naturales</th>
                      <th class="text-end">Sociales</th>
                      <th class="text-end">Ingl√©s</th>
                      <th class="text-center">Ranking</th>
                      <th class="text-center">Vs A√±o Anterior</th>
                      <th class="text-center">Tendencia</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- NEW: Insights Estrat√©gicos Section -->
      <div class="row">
        <div class="col-12 mb-3">
          <div class="card border-primary">
            <div class="card-header bg-primary bg-gradient text-white">
              <h5 class="card-title mb-0 text-white">
                <i class="bx bx-bulb me-1"></i> Insights Estrat√©gicos
              </h5>
            </div>
            <div class="card-body">

              <!-- Indicadores de Excelencia -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-muted mb-3"><i class="bx bx-trophy me-1"></i> Indicadores de Excelencia</h6>
                  <div id="achievementBadges" class="d-flex flex-wrap gap-2">
                    <!-- Badges will be populated by JavaScript -->
                  </div>
                </div>
              </div>


              <!-- NEW: Tarjetas de Indicadores de Excelencia Acad√©mica -->
              <div id="indicadoresExcelenciaSection" style="display: none;">
                <div class="row mb-3">
                  <div class="col-12">
                    <div class="alert alert-primary border-primary">
                      <h6 class="alert-heading"><i class="bx bx-star me-1"></i> Indicadores de Excelencia Acad√©mica</h6>
                      <p class="mb-0 small">M√©tricas clave que distinguen a los mejores colegios del pa√≠s</p>
                    </div>
                  </div>
                </div>

                <!-- Row with 4 cards -->
                <div class="row mb-3">
                  <!-- Excelencia Integral -->
                  <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card border-warning h-100">
                      <div class="card-body text-center">
                        <div class="mb-2">
                          <i class="bx bx-trophy" style="font-size: 2.5rem; color: #FFD700;"></i>
                        </div>
                        <h6 class="text-muted mb-2">Excelencia Integral</h6>
                        <h3 class="fw-bold text-warning mb-1" id="pctExcelenciaIntegral">--</h3>
                        <p class="text-muted small mb-2">Nivel 4 en TODAS las materias</p>
                        <span class="badge bg-info" id="rankingExcelenciaIntegral">--</span>
                        <div id="tendenciaExcelenciaIntegral" class="small mt-2">--</div>
                      </div>
                    </div>
                  </div>

                  <!-- Competencia Satisfactoria -->
                  <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card border-success h-100">
                      <div class="card-body text-center">
                        <div class="mb-2">
                          <i class="bx bx-check-circle" style="font-size: 2.5rem; color: #28a745;"></i>
                        </div>
                        <h6 class="text-muted mb-2">Competencia Satisfactoria</h6>
                        <h3 class="fw-bold text-success mb-1" id="pctCompetenciaSatisfactoria">--</h3>
                        <p class="text-muted small mb-2">Nivel 3+ en TODAS las materias</p>
                        <span class="badge bg-info" id="rankingCompetenciaSatisfactoria">--</span>
                        <div id="tendenciaCompetenciaSatisfactoria" class="small mt-2">--</div>
                      </div>
                    </div>
                  </div>

                  <!-- Perfil STEM -->
                  <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card border-primary h-100">
                      <div class="card-body text-center">
                        <div class="mb-2">
                          <i class="bx bx-atom" style="font-size: 2.5rem; color: #007bff;"></i>
                        </div>
                        <h6 class="text-muted mb-2">Perfil STEM Avanzado</h6>
                        <h3 class="fw-bold text-primary mb-1" id="pctPerfilStem">--</h3>
                        <p class="text-muted small mb-2">Nivel 4 en Math & Ciencias</p>
                        <span class="badge bg-info" id="rankingPerfilStem">--</span>
                        <div id="tendenciaPerfilStem" class="small mt-2">--</div>
                      </div>
                    </div>
                  </div>

                  <!-- Perfil Human√≠stico -->
                  <div class="col-lg-3 col-md-6 mb-3">
                    <div class="card border-info h-100">
                      <div class="card-body text-center">
                        <div class="mb-2">
                          <i class="bx bx-book-open" style="font-size: 2.5rem; color: #6f42c1;"></i>
                        </div>
                        <h6 class="text-muted mb-2">Perfil Human√≠stico Avanzado</h6>
                        <h3 class="fw-bold" style="color: #6f42c1;" id="pctPerfilHumanistico">--</h3>
                        <p class="text-muted small mb-2">Nivel 4 en Lectura & Sociales</p>
                        <span class="badge bg-info" id="rankingPerfilHumanistico">--</span>
                        <div id="tendenciaPerfilHumanistico" class="small mt-2">--</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Second row with Risk indicator -->
                <div class="row mb-3">
                  <!-- Riesgo Alto (5th indicator) -->
                  <div class="col-12">
                    <div class="card border-danger">
                      <div class="card-body">
                        <div class="row align-items-center">
                          <div class="col-md-2 text-center">
                            <i class="bx bx-error-circle" style="font-size: 3rem; color: #dc3545;"></i>
                          </div>
                          <div class="col-md-3 text-center">
                            <h6 class="text-muted mb-2">‚ö†Ô∏è Estudiantes en Riesgo Alto</h6>
                            <h2 class="fw-bold text-danger mb-1" id="pctRiesgoAlto">--</h2>
                            <p class="text-muted small mb-0">Nivel 1 (insuficiente) en 2+ materias</p>
                          </div>
                          <div class="col-md-3 text-center">
                            <p class="text-muted small mb-1">Comparaci√≥n Nacional</p>
                            <h4 class="mb-0" id="diferenciaRiesgo">--</h4>
                            <small class="text-muted">vs promedio nacional</small>
                          </div>
                          <div class="col-md-2 text-center">
                            <span class="badge bg-danger" id="rankingRiesgo">--</span>
                          </div>
                          <div class="col-md-2 text-center">
                            <div id="tendenciaRiesgo" class="small">--</div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Gr√°fico de Comparaci√≥n -->
                <div class="row">
                  <div class="col-12">
                    <div class="card">
                      <div class="card-header">
                        <h6 class="card-title mb-0">Comparaci√≥n con Promedio Nacional</h6>
                      </div>
                      <div class="card-body">
                        <div id="chartComparacionExcelencia"></div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Z-Score Explanation -->
              <div class="row mb-4" id="zscoreExplanation" style="display: none;">
                <div class="col-12">
                  <div class="alert alert-info border-info">
                    <h6 class="alert-heading"><i class="bx bx-info-circle me-1"></i> ¬øQu√© es el Z-Score?</h6>
                    <p class="mb-2 small">
                      El <strong>Z-Score</strong> (o puntuaci√≥n estandarizada) mide cu√°ntas <strong>desviaciones
                        est√°ndar</strong>
                      est√° su colegio por encima o debajo del promedio nacional.
                    </p>
                    <div class="row small">
                      <div class="col-md-6">
                        <strong>Interpretaci√≥n:</strong>
                        <ul class="mb-0 mt-1">
                          <li><span class="badge bg-success">+2.0 o m√°s</span> = <strong>√âlite</strong> (Top 2.5%)</li>
                          <li><span class="badge bg-success">+1.0 a +2.0</span> = <strong>Muy Superior</strong> (Top
                            16%)</li>
                          <li><span class="badge bg-info">+0.5 a +1.0</span> = <strong>Superior</strong> (Top 30%)</li>
                          <li><span class="badge bg-secondary">-0.5 a +0.5</span> = <strong>Promedio</strong> (38%
                            central)</li>
                          <li><span class="badge bg-warning">-1.0 a -0.5</span> = <strong>Por Debajo</strong></li>
                          <li><span class="badge bg-danger">-2.0 o menos</span> = <strong>Muy Bajo</strong></li>
                        </ul>
                      </div>
                      <div class="col-md-6">
                        <strong>¬øPor qu√© es √∫til?</strong>
                        <ul class="mb-0 mt-1">
                          <li>Permite comparar colegios de diferentes a√±os</li>
                          <li>No se afecta por cambios en la escala de puntajes</li>
                          <li>Muestra qu√© tan "excepcional" o "t√≠pico" es su colegio</li>
                          <li>Es el est√°ndar internacional para comparaciones estad√≠sticas</li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <hr>

              <!-- Mapa de Calor de Rendimiento -->
              <div class="row mb-4">
                <div class="col-12">
                  <h6 class="text-muted mb-3"><i class="bx bx-grid-alt me-1"></i> Mapa de Calor: Rendimiento por Materia
                  </h6>
                  <div class="table-responsive">
                    <table class="table table-sm table-bordered" id="heatmapTable">
                      <thead class="table-light">
                        <tr>
                          <th>Materia</th>
                          <th class="text-center" id="heatYear1">--</th>
                          <th class="text-center" id="heatYear2">--</th>
                          <th class="text-center" id="heatYear3">--</th>
                          <th class="text-center" id="heatYear4">--</th>
                          <th class="text-center" id="heatYear5">--</th>
                          <th class="text-center">Tendencia</th>
                        </tr>
                      </thead>
                      <tbody id="heatmapBody">
                        <!-- Will be populated by JavaScript -->
                      </tbody>
                    </table>
                  </div>
                  <div class="d-flex justify-content-end gap-2 mt-2">
                    <span class="badge" style="background-color: #dc3545;">Bajo (&lt;40)</span>
                    <span class="badge" style="background-color: #ffc107; color: #000;">Medio (40-60)</span>
                    <span class="badge" style="background-color: #28a745;">Alto (&gt;60)</span>
                  </div>
                </div>
              </div>

              <hr>

              <!-- Simulador de Mejora -->
              <div class="row">
                <div class="col-md-6">
                  <h6 class="text-muted mb-3"><i class="bx bx-calculator me-1"></i> Simulador: ¬øQu√© pasar√≠a si...?</h6>
                  <div class="mb-3">
                    <label class="form-label">Materia a mejorar</label>
                    <select class="form-select" id="simulatorSubject">
                      <option value="matematicas">Matem√°ticas</option>
                      <option value="lectura">Lectura Cr√≠tica</option>
                      <option value="c_naturales">C. Naturales</option>
                      <option value="sociales">Sociales</option>
                      <option value="ingles">Ingl√©s</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Puntos de mejora: <span id="improvementValue">5</span></label>
                    <input type="range" class="form-range" id="improvementSlider" min="1" max="20" value="5">
                  </div>
                  <button class="btn btn-primary w-100" id="simulateBtn">
                    <i class="bx bx-play-circle me-1"></i> Simular Impacto
                  </button>
                </div>
                <div class="col-md-6">
                  <h6 class="text-muted mb-3">Resultado de la Simulaci√≥n</h6>
                  <div id="simulationResult" class="alert alert-info">
                    <p class="mb-2"><strong>Selecciona una materia y ajusta los puntos de mejora</strong></p>
                    <p class="mb-0 small">El simulador te mostrar√° el impacto en tu ranking y percentil</p>
                  </div>
                  <div id="simulationDetails" style="display: none;">
                    <div class="card bg-light">
                      <div class="card-body">
                        <div class="mb-2">
                          <small class="text-muted">Puntaje Global Actual</small>
                          <h4 class="mb-0" id="simCurrentScore">--</h4>
                        </div>
                        <div class="mb-2">
                          <small class="text-muted">Puntaje Global Proyectado</small>
                          <h4 class="mb-0 text-success" id="simProjectedScore">--</h4>
                        </div>
                        <div class="mb-2">
                          <small class="text-muted">Mejora en Ranking Nacional</small>
                          <h5 class="mb-0 text-primary" id="simRankingChange">--</h5>
                        </div>
                        <div>
                          <small class="text-muted">Nuevo Percentil</small>
                          <div class="progress" style="height: 25px;">
                            <div id="simPercentilBar" class="progress-bar bg-success" role="progressbar"
                              style="width: 0%">
                              <span id="simPercentilValue">--</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>

      <!-- AI Recommendations -->
      <div class="row">
        <div class="col-12 mb-3">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="card-title mb-0">
                <i class="bx bx-brain me-1"></i> An√°lisis y Recomendaciones IA
              </h5>
              <button class="btn btn-sm btn-primary" id="generateAIBtn">
                <i class="bx bx-brain"></i> Generar An√°lisis
              </button>
            </div>
            <div class="card-body">
              <div id="aiRecommendations">
                <p class="text-muted">
                  Haz clic en "Generar An√°lisis" para obtener recomendaciones personalizadas
                  basadas en IA sobre c√≥mo mejorar el rendimiento del colegio.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Explorador Jer√°rquico Tab -->
  <div class="tab-pane fade" id="explorador" role="tabpanel">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h4 class="card-title mb-0">Explorador Jer√°rquico - ICFES</h4>
        <div>
          <select id="hierarchy-year-selector" class="form-select form-select-sm">
            <optgroup label="2020s">
              <option value="2024">2024</option>
              <option value="2023">2023</option>
              <option value="2022">2022</option>
              <option value="2021">2021</option>
              <option value="2020">2020</option>
            </optgroup>
            <optgroup label="2010s">
              <option value="2019">2019</option>
              <option value="2018">2018</option>
              <option value="2017">2017</option>
              <option value="2016">2016</option>
              <option value="2015">2015</option>
              <option value="2014">2014</option>
              <option value="2013">2013</option>
              <option value="2012">2012</option>
              <option value="2011">2011</option>
              <option value="2010">2010</option>
            </optgroup>
            <optgroup label="2000s">
              <option value="2009">2009</option>
              <option value="2008">2008</option>
              <option value="2007">2007</option>
              <option value="2006">2006</option>
              <option value="2005">2005</option>
              <option value="2004">2004</option>
              <option value="2003">2003</option>
              <option value="2002">2002</option>
              <option value="2001">2001</option>
              <option value="2000">2000</option>
            </optgroup>
            <optgroup label="1990s">
              <option value="1999">1999</option>
              <option value="1998">1998</option>
              <option value="1997">1997</option>
              <option value="1996">1996</option>
            </optgroup>
          </select>
        </div>
      </div>
      <div class="card-body p-0">
        <div class="table-responsive">
          <table class="table table-hover table-sm mb-0" id="hierarchical-table">
            <thead class="table-light">
              <tr>
                <th style="width: 25%">Entidad</th>
                <th class="text-end">Global</th>
                <th class="text-end">Matem√°ticas</th>
                <th class="text-end">Lectura</th>
                <th class="text-end">C. Naturales</th>
                <th class="text-end">Sociales</th>
                <th class="text-end">Ingl√©s</th>
                <th class="text-center">Ranking</th>
                <th class="text-center">Tendencia</th>
                <th class="text-center">Z-Score</th>
                <th class="text-center">Percentil</th>
              </tr>
            </thead>
            <tbody id="hierarchical-tbody">
              <tr>
                <td colspan="11" class="text-center py-4">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock page_content %}

{% block extra_javascript %}
<script src="{% static '/vendor/apexcharts/apexcharts.min.js' %}"></script>
<script src="{% static 'js/pages/dashboard.icfes.js' %}?v=5"></script>
<script src="{% static 'js/pages/dashboard.icfes.school.js' %}?v=5"></script>
<script src="{% static 'js/pages/dashboard.icfes.school.table.js' %}?v=5"></script>
<script src="{% static 'js/pages/dashboard.icfes.school.insights.js' %}?v=2"></script>
{% endblock extra_javascript %}